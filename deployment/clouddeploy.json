{
    "steps": [
        {
            "name": "gcr.io/cloud-builders/docker",
            "args": ["build", "-t", "gcr.io/${PROJECT_ID}/nodeapp:latest", "-t", "gcr.io/${PROJECT_ID}/nodeapp:${SHORT_SHA}", "."]
        },
        {
            "name": "gcr.io/cloud-builders/docker",
            "args": ["push", "gcr.io/${PROJECT_ID}/nodeapp:latest"]
        },
        {
            "name": "gcr.io/cloud-builders/docker",
            "args": ["push", "gcr.io/${PROJECT_ID}/nodeapp:${SHORT_SHA}"]
        },
        {
            "name": "gcr.io/${PROJECT_ID}/helm",
            "args": ["install", "--name", "node-demo", "--namespace", "node-demo", "stable/nginx-ingress"],
            "env": ["CLOUDSDK_CONTAINER_CLUSTER=k8s-demo-cluster", "CLOUDSDK_COMPUTE_REGION=europe-west1-b", "TILLERLESS=true"]
        }
    ],
    "timeout": "240s"
}